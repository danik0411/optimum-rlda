# the code to rewrite all data from temp files to a single one

moveTempToFinal = function( tempFileNames , outputFileName , word , namesOfVARS , namesOfEstimators , repetition , gammaValues , sampleSize ) {

# tempFileNames - the array of paths form which variables should be moved to outputFileName
# outputFileName - the name of the file that will be used to store all the variabes
# word - the main word for the data type, for example, rats, cancer, liver etc
# namesOfVARS - an array of the strings which depicts the main type of the output variables, for example Time Error etc
# namesOfEstimators - an array of the estimator names which are used in the analysis
# repetition - number of repetitions that are used in the calculations
# gammaValues - an array of gammaValues used in the calculations
# sampeSize - an array of sample size


# create the variables for the rats data, i.g. rats_totalErrorDouble etc
print("creating the variables of totalError and totaTime");
for ( i in 1:numberOfVARS ) {
    for( j in 1:numberOfEstimators ) {
    	 s1 = sprintf("%s_total%s%s" , word, namesOfVARS[i] , namesOfEstimators[j] );
	 s2 = sprintf("array(-1,dim=c(repetition,length(gammaValues),length(sampleSize)))");
    	 myExp = paste(s1,"=",s2,sep="");
	 print(myExp);
    	 eval(parse(text=myExp));
    }
}

# write all data from temp files to the variables just created
print("writing the data from temp files to variables");
for( k in 1:length(sampleSize) ) {
load(tempFileNames[k]);
for ( i in 1:numberOfVARS ) {
    for( j in 1:numberOfEstimators ) {
    	 s1 = sprintf("%s_total%s%s[,,%s]" , word, namesOfVARS[i] , namesOfEstimators[j] , as.character(k) );
	 s2 = sprintf("total%s%s" , namesOfVARS[i] , namesOfEstimators[j] );
    	 myExp = paste(s1,"=",s2,sep="");
	 print(myExp);
    	 eval(parse(text=myExp));
    }
}

}

print(sprintf("saving the data to %s" , outputFileName));
varsToSave = ls(all=TRUE, pattern="total");
varsToSave = c( varsToSave , "gammaValues" , "sampleSize" , "repetition" );

save( list=varsToSave , file=outputFileName );

}